{{- if .Values.grafana.dashboards.enable }}
{{- $files := .Files }}
{{- range $path, $bytes := .Files.Glob "dashboards/*.json" }}
{{- $filename := trimSuffix (ext $path) (base $path) }}
apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ printf "%s-%s" $.Chart.Name $filename | trunc 63 | trimSuffix "-" }}
  namespace: {{ $.Values.grafana.namespace }}
  labels:
    grafana_dashboard: "1"
    created_by: "{{ $.Chart.Name }}"
    heritage: "{{ .Release.Service }}"
    app.kubernetes.io/managed-by: "Helm"
  annotations:
    meta.helm.sh/release-name: "{{ .Release.Name }}"
    meta.helm.sh/release-namespace: "{{ .Release.Namespace }}"
data:
  {{ base $path }}: '{{ $files.Get $path }}'
---
{{- end }}
{{- end }}
